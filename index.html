<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HRMS - Human Resources Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for the HRMS UI */
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Hide pages by default, show only the active one */
        .page-content {
            display: none;
        }
        .page-content.active {
            display: block;
        }

        /* Active navigation link styling */
        .nav-link.active-nav-link {
            background-color: #3B82F6; /* blue-500 */
            color: #FFFFFF; /* white */
        }
        .nav-link.active-nav-link:hover {
             background-color: #2563EB; /* blue-600 */
        }

        /* Simple fade-in animation for dropdowns/modals */
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-down {
            animation: fadeInDown 0.2s ease-out forwards;
        }

        /* Loading spinner animation */
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #fff;
            border-radius: 50%;
            width: 1.5rem;
            height: 1.5rem;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="font-inter antialiased bg-gray-100 min-h-screen flex flex-col">

    <div id="app-container" class="flex flex-1">

        <div id="landing-page" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-500 to-indigo-600 p-4 w-full">
            <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-md border border-gray-200">
                <div class="text-center mb-8">
                    <h1 class="text-4xl font-extrabold text-gray-900 mb-2">HRMS</h1>
                    <p class="text-gray-600">Human Resources Management System</p>
                </div>

                <div id="auth-form-login" class="auth-form-content active">
                    <h2 class="text-3xl font-bold text-gray-800 text-center mb-6">Sign In to HRMS</h2>
                    <div id="login-error-message" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-md relative hidden mb-4" role="alert">
                        <span class="block sm:inline"></span>
                    </div>
                    <form id="login-form" class="space-y-6">
                        <div>
                            <label for="login-email" class="block text-gray-700 text-sm font-semibold mb-2">Email</label>
                            <input
                                type="email"
                                id="login-email"
                                class="shadow-sm appearance-none border border-gray-300 rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200"
                                placeholder="your@example.com"
                                required
                            />
                        </div>
                        <div>
                            <label for="login-password" class="block text-gray-700 text-sm font-semibold mb-2">Password</label>
                            <div class="relative">
                                <input
                                    type="password"
                                    id="login-password"
                                    class="shadow-sm appearance-none border border-gray-300 rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 pr-10"
                                    placeholder="********"
                                    required
                                    minlength="6"
                                />
                                <button type="button" id="toggle-login-password" class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-600 hover:text-gray-900 focus:outline-none">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        <button
                            type="submit"
                            id="login-button"
                            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg focus:outline-none focus:shadow-outline transition duration-300 transform hover:scale-105 shadow-lg flex items-center justify-center"
                        >
                            <span id="login-button-text">Sign In</span>
                            <div id="login-spinner" class="spinner ml-3 hidden"></div>
                        </button>
                    </form>
                    <div class="mt-8 text-center text-gray-600">
                        <p>Don't have an account?
                            <button id="show-register-form" class="font-semibold text-blue-600 hover:underline focus:outline-none ml-1">
                                Register here
                            </button>
                        </p>
                    </div>
                </div>

                <div id="auth-form-register" class="auth-form-content hidden">
                    <h2 class="text-3xl font-bold text-gray-800 text-center mb-6">Create Your Account</h2>
                    <div id="register-error-message" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-md relative hidden mb-4" role="alert">
                        <span class="block sm:inline"></span>
                    </div>
                    <form id="register-form" class="space-y-6">
                        <div>
                            <label for="register-email" class="block text-gray-700 text-sm font-semibold mb-2">Email</label>
                            <input
                                type="email"
                                id="register-email"
                                class="shadow-sm appearance-none border border-gray-300 rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200"
                                placeholder="your@example.com"
                                required
                            />
                        </div>
                        <div>
                            <label for="register-password" class="block text-gray-700 text-sm font-semibold mb-2">Password</label>
                            <div class="relative">
                                <input
                                    type="password"
                                    id="register-password"
                                    class="shadow-sm appearance-none border border-gray-300 rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 pr-10"
                                    placeholder="********"
                                    required
                                    minlength="6"
                                />
                                <button type="button" id="toggle-register-password" class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-600 hover:text-gray-900 focus:outline-none">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        <div>
                            <label for="confirm-password" class="block text-gray-700 text-sm font-semibold mb-2">Confirm Password</label>
                            <div class="relative">
                                <input
                                    type="password"
                                    id="confirm-password"
                                    class="shadow-sm appearance-none border border-gray-300 rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 pr-10"
                                    placeholder="********"
                                    required
                                />
                                <button type="button" id="toggle-confirm-password" class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-600 hover:text-gray-900 focus:outline-none">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        <button
                            type="submit"
                            id="register-button"
                            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg focus:outline-none focus:shadow-outline transition duration-300 transform hover:scale-105 shadow-lg flex items-center justify-center"
                        >
                            <span id="register-button-text">Register</span>
                            <div id="register-spinner" class="spinner ml-3 hidden"></div>
                        </button>
                    </form>
                    <div class="mt-8 text-center text-gray-600">
                        <p>Already have an account?
                            <button id="show-login-form" class="font-semibold text-blue-600 hover:underline focus:outline-none ml-1">
                                Login here
                            </button>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div id="hrms-main-layout" class="hidden flex-1 flex flex-col">
            <header id="top-banner" class="fixed top-0 left-0 right-0 h-16 bg-white shadow-md flex items-center justify-between px-4 z-40 transition-all duration-300 md:pl-64 rounded-b-lg">
                <div class="flex items-center">
                    <button id="sidebar-toggle" class="md:hidden p-2 text-gray-600 hover:text-gray-900 focus:outline-none rounded-md">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                    <h1 id="page-title" class="text-2xl font-bold text-gray-800 ml-4">Dashboard</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="relative">
                        <input type="text" placeholder="Search..." class="border border-gray-300 rounded-full pl-10 pr-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200">
                        <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"></i>
                    </div>
                    <div class="relative">
                        <button id="notifications-button" class="p-2 text-gray-600 hover:text-gray-900 focus:outline-none rounded-md relative">
                            <i class="fas fa-bell text-xl"></i>
                            <span class="absolute top-1 right-1 h-2.5 w-2.5 bg-red-500 rounded-full border-2 border-white"></span>
                        </button>
                        <div id="notifications-dropdown" class="absolute right-0 mt-2 w-64 bg-white border border-gray-200 rounded-lg shadow-lg py-2 z-50 hidden">
                            <p class="px-4 py-2 text-sm text-gray-700">No new notifications.</p>
                        </div>
                    </div>
                </div>
            </header>

            <aside id="sidebar" class="fixed top-0 bottom-0 left-0 w-64 bg-gray-800 text-white shadow-lg z-50 transform -translate-x-full md:translate-x-0 transition-transform duration-300 flex flex-col pt-16 rounded-r-lg">
                <div class="p-4 text-center">
                    <h2 class="text-3xl font-extrabold text-blue-400 mb-4">HRMS</h2>
                    <div class="border-b border-gray-700 mb-4"></div>
                    <img id="sidebar-profile-avatar" src="https://placehold.co/60x60/ADD8E6/000000?text=HR" alt="Profile" class="w-20 h-20 rounded-full mx-auto mb-3 border-3 border-blue-400 shadow-lg">
                    <p id="sidebar-profile-name" class="font-semibold text-xl text-gray-100">Loading...</p>
                    <p id="sidebar-profile-position" class="text-sm text-gray-400">Loading...</p>
                    <div class="border-b border-gray-700 mt-4 mb-4"></div>
                </div>
                <nav class="flex-1 px-4 overflow-y-auto">
                    <ul>
                        <li class="mb-2"><button data-page="dashboard" class="nav-link flex items-center w-full py-2 px-3 rounded-lg text-left transition duration-200 active-nav-link"><i class="fas fa-tachometer-alt w-5 h-5 mr-3"></i><span>Dashboard</span></button></li>
                        <li class="mb-2"><button data-page="employee-management" class="nav-link flex items-center w-full py-2 px-3 rounded-lg text-left transition duration-200"><i class="fas fa-users w-5 h-5 mr-3"></i><span>Employee Management</span></button></li>
                        <li class="mb-2"><button data-page="leave-management" class="nav-link flex items-center w-full py-2 px-3 rounded-lg text-left transition duration-200"><i class="fas fa-calendar-alt w-5 h-5 mr-3"></i><span>Leave Management</span></button></li>
                        <li class="mb-2"><button data-page="scheduling" class="nav-link flex items-center w-full py-2 px-3 rounded-lg text-left transition duration-200"><i class="fas fa-calendar-check w-5 h-5 mr-3"></i><span>Staff Scheduling</span></button></li>
                        <li class="mb-2"><button data-page="training" class="nav-link flex items-center w-full py-2 px-3 rounded-lg text-left transition duration-200"><i class="fas fa-graduation-cap w-5 h-5 mr-3"></i><span>Employee Training</span></button></li>
                        <li class="mb-2"><button data-page="performance" class="nav-link flex items-center w-full py-2 px-3 rounded-lg text-left transition duration-200"><i class="fas fa-chart-line w-5 h-5 mr-3"></i><span>Employee Performance</span></button></li>
                        <li class="mb-2"><button data-page="ranking" class="nav-link flex items-center w-full py-2 px-3 rounded-lg text-left transition duration-200"><i class="fas fa-trophy w-5 h-5 mr-3"></i><span>Ranking & Recognition</span></button></li>
                        <li class="mb-2 border-t border-gray-700 pt-4 mt-4"></li>
                        <li class="mb-2"><button data-page="profile" class="nav-link flex items-center w-full py-2 px-3 rounded-lg text-left transition duration-200"><i class="fas fa-user-circle w-5 h-5 mr-3"></i><span>Profile</span></button></li>
                        <li class="mb-2"><button data-page="settings" class="nav-link flex items-center w-full py-2 px-3 rounded-lg text-left transition duration-200"><i class="fas fa-cogs w-5 h-5 mr-3"></i><span>Settings</span></button></li>
                    </ul>
                </nav>
                <div class="p-4 border-t border-gray-700">
                    <button id="logout-button" class="w-full bg-red-600 text-white py-2 px-3 rounded-lg hover:bg-red-700 transition duration-200 shadow-md flex items-center justify-center space-x-2">
                        <i class="fas fa-sign-out-alt w-5 h-5 mr-3"></i><span>Logout</span>
                    </button>
                </div>
            </aside>

            <main id="main-content" class="flex-1 p-4 pt-20 transition-all duration-300 md:ml-64 md:pt-20">
                <div id="dashboard-page" class="page-content active">
                    <div class="p-6 bg-white rounded-lg shadow-md">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">Dashboard Overview</h2>
                        <p class="text-gray-700">Welcome to your HRMS dashboard. Here you'll find key insights into employee turnover, absenteeism, and current leaves.</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-6">
                            <div class="bg-blue-50 p-4 rounded-lg shadow-sm">
                                <h3 class="font-semibold text-lg text-blue-800">Employee Turnover Rate</h3>
                                <p class="text-sm text-blue-600">Visualize trends and causes.</p>
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg shadow-sm">
                                <h3 class="font-semibold text-lg text-green-800">Absenteeism & Tardiness</h3>
                                <p class="text-sm text-green-600">Highlight patterns and frequent absences.</p>
                            </div>
                            <div class="bg-yellow-50 p-4 rounded-lg shadow-sm">
                                <h3 class="font-semibold text-lg text-yellow-800">Employees on Leave</h3>
                                <p class="text-sm text-yellow-600">Live tracker for leave types and return dates.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="employee-management-page" class="page-content">
                    <div class="p-6 bg-white rounded-lg shadow-md">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">Employee Records</h2>
                        <div class="mb-6 flex flex-col md:flex-row items-center justify-between space-y-4 md:space-y-0 md:space-x-4">
                            <div class="flex items-center space-x-2 w-full md:w-auto">
                                <label for="department-filter" class="text-gray-700 font-medium">Filter by Department:</label>
                                <select id="department-filter" class="border border-gray-300 rounded-md p-2 focus:ring-blue-500 focus:border-blue-500 w-full md:w-auto">
                                    <option value="">All</option>
                                    <option value="HR">HR</option>
                                    <option value="IT">IT</option>
                                    <option value="Sales">Sales</option>
                                    <option value="Marketing">Marketing</option>
                                    <option value="Operations">Operations</option>
                                    <option value="Finance">Finance</option>
                                    <option value="Design">Design</option>
                                    <option value="R&D">R&D</option>
                                    <option value="Support">Support</option>
                                    <option value="Product">Product</option>
                                </select>
                            </div>
                            <div class="relative w-full md:w-auto">
                                <input type="text" placeholder="Search employees..." id="employee-search" class="border border-gray-300 rounded-full pl-10 pr-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200 w-full">
                                <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"></i>
                            </div>
                            <button class="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition duration-300 shadow-md w-full md:w-auto">
                                Add New Employee
                            </button>
                        </div>

                        <div class="overflow-x-auto rounded-lg border border-gray-200 shadow-sm">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                                        <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Job Title</th>
                                        <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Department</th>
                                        <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                        <th class="py-3 px-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="employee-table-body" class="bg-white divide-y divide-gray-200">
                                    </tbody>
                            </table>
                        </div>
                        <div id="employee-pagination" class="flex justify-center mt-6">
                            </div>
                    </div>
                </div>

                <div id="leave-management-page" class="page-content">
                    <div class="p-6 bg-white rounded-lg shadow-md">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">Leave Management</h2>
                        <p class="text-gray-700">Submit new leave requests, track approvals, and view leave history and balances.</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                            <button class="bg-purple-600 text-white px-6 py-3 rounded-lg shadow-md hover:bg-purple-700 transition duration-300 flex items-center justify-center space-x-2">
                                <i class="fas fa-calendar-alt w-5 h-5"></i> <span>Leave Requests & Approval</span>
                            </button>
                            <button class="bg-teal-600 text-white px-6 py-3 rounded-lg shadow-md hover:bg-teal-700 transition duration-300 flex items-center justify-center space-x-2">
                                <i class="fas fa-calendar-alt w-5 h-5"></i> <span>Leave Balances</span>
                            </button>
                            <button class="bg-orange-600 text-white px-6 py-3 rounded-lg shadow-md hover:bg-orange-700 transition duration-300 flex items-center justify-center space-x-2">
                                <i class="fas fa-calendar-alt w-5 h-5"></i> <span>Leave History</span>
                            </button>
                        </div>
                    </div>
                </div>

                <div id="scheduling-page" class="page-content">
                    <div class="p-6 bg-white rounded-lg shadow-md">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">Staff Scheduling</h2>
                        <p class="text-gray-700">Facilitates the creation and management of staff schedules, shift rotations, and time-off planning.</p>
                    </div>
                </div>
                <div id="training-page" class="page-content">
                    <div class="p-6 bg-white rounded-lg shadow-md">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">Employee Training</h2>
                        <p class="text-gray-700">Tracks mandatory and voluntary training programs, certifications, and course completions.</p>
                    </div>
                </div>
                <div id="performance-page" class="page-content">
                    <div class="p-6 bg-white rounded-lg shadow-md">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">Employee Performance</h2>
                        <p class="text-gray-700">Automates performance review cycles and tracks employee goals, achievements, and development plans.</p>
                    </div>
                </div>
                <div id="ranking-page" class="page-content">
                    <div class="p-6 bg-white rounded-lg shadow-md">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">Ranking & Recognition</h2>
                        <p class="text-gray-700">Employees are ranked monthly based on performance metrics, KPIs, and peer reviews.</p>
                    </div>
                </div>
                <div id="profile-page" class="page-content">
                    <div class="p-6 bg-white rounded-lg shadow-md">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">Profile</h2>
                        <p class="text-gray-700">View and edit your personal employee profile details.</p>
                    </div>
                </div>
                <div id="settings-page" class="page-content">
                    <div class="p-6 bg-white rounded-lg shadow-md">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">Settings</h2>
                        <p class="text-700">Manage application settings and preferences.</p>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
        // --- Supabase Configuration (Replace with your actual project details) ---
        const SUPABASE_URL = "YOUR_SUPABASE_PROJECT_URL"; // e.g., "https://abcdefghijk.supabase.co"
        const SUPABASE_ANON_KEY = "YOUR_SUPABASE_ANON_PUBLIC_KEY"; // e.g., "eyJhbGciOiJIUzI1NiI..."

        const supabase = Supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // --- DOM Elements ---
        const landingPage = document.getElementById('landing-page');
        const hrmsMainLayout = document.getElementById('hrms-main-layout');
        const authFormLogin = document.getElementById('auth-form-login');
        const authFormRegister = document.getElementById('auth-form-register');
        const showRegisterFormBtn = document.getElementById('show-register-form');
        const showLoginFormBtn = document.getElementById('show-login-form');

        const loginForm = document.getElementById('login-form');
        const loginEmailInput = document.getElementById('login-email');
        const loginPasswordInput = document.getElementById('login-password');
        const loginButton = document.getElementById('login-button');
        const loginButtonText = document.getElementById('login-button-text');
        const loginSpinner = document.getElementById('login-spinner');
        const loginErrorMessage = document.getElementById('login-error-message');

        const registerForm = document.getElementById('register-form');
        const registerEmailInput = document.getElementById('register-email');
        const registerPasswordInput = document.getElementById('register-password');
        const confirmPasswordInput = document.getElementById('confirm-password');
        const registerButton = document.getElementById('register-button');
        const registerButtonText = document.getElementById('register-button-text');
        const registerSpinner = document.getElementById('register-spinner');
        const registerErrorMessage = document.getElementById('register-error-message');

        const toggleLoginPassword = document.getElementById('toggle-login-password');
        const toggleRegisterPassword = document.getElementById('toggle-register-password');
        const toggleConfirmPassword = document.getElementById('toggle-confirm-password');

        // --- UI Elements for Main HRMS Layout ---
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('main-content');
        const topBanner = document.getElementById('top-banner');
        const sidebarToggleBtn = document.getElementById('sidebar-toggle');
        const navLinks = document.querySelectorAll('.nav-link');
        const pageContents = document.querySelectorAll('.page-content');
        const pageTitleElement = document.getElementById('page-title');
        const notificationsButton = document.getElementById('notifications-button');
        const notificationsDropdown = document.getElementById('notifications-dropdown');
        const logoutButton = document.getElementById('logout-button');

        const sidebarProfileName = document.getElementById('sidebar-profile-name');
        const sidebarProfilePosition = document.getElementById('sidebar-profile-position');
        const sidebarProfileAvatar = document.getElementById('sidebar-profile-avatar');

        let isSidebarOpen = window.innerWidth >= 768; // Sidebar starts open on desktop
        let currentAuthenticatedUser = null; // To store the Supabase user object

        // --- Helper Functions ---

        function showMessage(element, message, isError = true) {
            element.textContent = message;
            element.classList.remove('hidden');
            if (isError) {
                element.classList.remove('bg-green-100', 'text-green-700', 'border-green-400');
                element.classList.add('bg-red-100', 'text-red-700', 'border-red-400');
            } else {
                element.classList.remove('bg-red-100', 'text-red-700', 'border-red-400');
                element.classList.add('bg-green-100', 'text-green-700', 'border-green-400');
            }
        }

        function hideMessage(element) {
            element.classList.add('hidden');
            element.textContent = '';
        }

        function togglePasswordVisibility(inputElement, toggleButton) {
            if (inputElement.type === 'password') {
                inputElement.type = 'text';
                toggleButton.querySelector('i').classList.replace('fa-eye', 'fa-eye-slash');
            } else {
                inputElement.type = 'password';
                toggleButton.querySelector('i').classList.replace('fa-eye-slash', 'fa-eye');
            }
        }

        function setButtonLoading(button, textElement, spinnerElement, isLoading) {
            if (isLoading) {
                textElement.textContent = '';
                spinnerElement.classList.remove('hidden');
                button.disabled = true;
                button.classList.add('opacity-75', 'cursor-not-allowed');
            } else {
                textElement.textContent = button.dataset.originalText; // Restore original text
                spinnerElement.classList.add('hidden');
                button.disabled = false;
                button.classList.remove('opacity-75', 'cursor-not-allowed');
            }
        }

        // --- Authentication Logic ---

        async function handleLogin(e) {
            e.preventDefault();
            hideMessage(loginErrorMessage);
            setButtonLoading(loginButton, loginButtonText, loginSpinner, true);
            loginButton.dataset.originalText = loginButtonText.textContent; // Store original text

            const email = loginEmailInput.value;
            const password = loginPasswordInput.value;

            try {
                const { data, error } = await supabase.auth.signInWithPassword({ email, password });
                if (error) throw error;

                currentAuthenticatedUser = data.user;
                console.log("Login successful:", currentAuthenticatedUser);
                showMessage(loginErrorMessage, "Login successful!", false);

                // Fetch employee details or create if not exists
                await ensureEmployeeRecord(currentAuthenticatedUser);

                // Transition to main HRMS layout
                showHRMSLayout();
            } catch (error) {
                console.error("Login error:", error.message);
                showMessage(loginErrorMessage, error.message || "An unexpected error occurred. Please try again.");
            } finally {
                setButtonLoading(loginButton, loginButtonText, loginSpinner, false);
            }
        }

        async function handleRegister(e) {
            e.preventDefault();
            hideMessage(registerErrorMessage);
            setButtonLoading(registerButton, registerButtonText, registerSpinner, true);
            registerButton.dataset.originalText = registerButtonText.textContent; // Store original text

            const email = registerEmailInput.value;
            const password = registerPasswordInput.value;
            const confirmPassword = confirmPasswordInput.value;

            if (password !== confirmPassword) {
                showMessage(registerErrorMessage, "Passwords do not match!");
                setButtonLoading(registerButton, registerButtonText, registerSpinner, false);
                return;
            }

            try {
                const { data, error } = await supabase.auth.signUp({ email, password });
                if (error) throw error;

                currentAuthenticatedUser = data.user;
                console.log("Registration successful:", currentAuthenticatedUser);
                showMessage(registerErrorMessage, "Registration successful! Please check your email to confirm your account and then log in.", false);

                // Immediately create an employee record for the new user
                await createEmployeeRecordForNewUser(currentAuthenticatedUser);

                // After registration, typically you'd wait for email confirmation.
                // For this demo, we'll switch to login form after a short delay.
                setTimeout(() => {
                    showAuthForm('login');
                    hideMessage(registerErrorMessage);
                    // Clear registration form fields
                    registerEmailInput.value = '';
                    registerPasswordInput.value = '';
                    confirmPasswordInput.value = '';
                }, 3000); // Give user time to read message
            } catch (error) {
                console.error("Registration error:", error.message);
                showMessage(registerErrorMessage, error.message || "An unexpected error occurred. Please try again.");
            } finally {
                setButtonLoading(registerButton, registerButtonText, registerSpinner, false);
            }
        }

        async function handleLogout() {
            try {
                const { error } = await supabase.auth.signOut();
                if (error) throw error;
                console.log("Logged out successfully.");
                currentAuthenticatedUser = null; // Clear user state
                showMessage(loginErrorMessage, "Logged out successfully!", false); // Show message on login page
                showLandingPage(); // Go back to landing page
            } catch (error) {
                console.error("Logout error:", error.message);
                showMessage(loginErrorMessage, error.message || "Failed to log out.");
            }
        }

        function showAuthForm(formType) {
            if (formType === 'login') {
                authFormLogin.classList.remove('hidden');
                authFormLogin.classList.add('active');
                authFormRegister.classList.add('hidden');
                authFormRegister.classList.remove('active');
            } else {
                authFormRegister.classList.remove('hidden');
                authFormRegister.classList.add('active');
                authFormLogin.classList.add('hidden');
                authFormLogin.classList.remove('active');
            }
            hideMessage(loginErrorMessage);
            hideMessage(registerErrorMessage);
        }

        // --- Supabase Data Interaction (for employees table) ---

        async function ensureEmployeeRecord(user) {
            if (!user) return;

            try {
                // Check if an employee record already exists for this user_id
                const { data, error } = await supabase
                    .from('employees')
                    .select('*')
                    .eq('user_id', user.id)
                    .single();

                if (error && error.code !== 'PGRST116') { // PGRST116 means "no rows found"
                    throw error;
                }

                if (data) {
                    console.log("Employee record found:", data);
                    updateSidebarProfile(data); // Update UI with fetched employee data
                } else {
                    console.log("No employee record found for user. Creating one...");
                    await createEmployeeRecordForNewUser(user);
                }
            } catch (error) {
                console.error("Error ensuring employee record:", error.message);
                // Handle error (e.g., show a message to the user)
            }
        }

        async function createEmployeeRecordForNewUser(user) {
            if (!user) return;

            try {
                // Extract first and last name from email if possible, or use defaults
                const [firstNamePart, lastNamePart] = user.email.split('@')[0].split('.');
                const firstName = firstNamePart ? firstNamePart.charAt(0).toUpperCase() + firstNamePart.slice(1) : 'New';
                const lastName = lastNamePart ? lastNamePart.charAt(0).toUpperCase() + lastNamePart.slice(1) : 'User';

                const { data, error } = await supabase
                    .from('employees')
                    .insert([
                        {
                            user_id: user.id,
                            email: user.email,
                            "firstName": firstName,
                            "lastName": lastName,
                            "hireDate": new Date().toISOString().split('T')[0], // Current date
                            status: 'Active',
                            // You might want to add default positionID/departmentID here
                        }
                    ])
                    .select()
                    .single(); // Use .single() if you expect one record back

                if (error) throw error;
                console.log("New employee record created:", data);
                updateSidebarProfile(data); // Update UI with new employee data
            } catch (error) {
                console.error("Error creating employee record:", error.message);
                // Handle error (e.g., alert user, log to console)
            }
        }


        async function fetchEmployeesForTable() {
            try {
                // Fetch all employees. RLS policies will ensure only authorized data is returned.
                const { data, error } = await supabase
                    .from('employees')
                    .select('"employeeID", "firstName", "lastName", email, status, "positionID", "departmentID"'); // Select specific columns

                if (error) throw error;

                // For the table, we need position title and department name.
                // This would ideally be done with a JOIN in a FastAPI backend.
                // For direct Supabase client, we'll fetch them separately or rely on pre-populated data.
                // For simplicity, let's just use email as name and status.
                // You'll need to fetch positions and departments separately if you want to display their names.

                // Mocking position and department for display purposes for now
                const employeesWithDisplayInfo = data.map(emp => ({
                    id: emp.employeeID,
                    name: `${emp.firstName} ${emp.lastName}`,
                    title: 'N/A', // You'd fetch this from positions table
                    department: 'N/A', // You'd fetch this from departments table
                    status: emp.status
                }));

                // Apply current filters and search
                const filterDepartment = document.getElementById('department-filter').value;
                const searchTerm = document.getElementById('employee-search').value.toLowerCase();

                const filteredAndSearched = employeesWithDisplayInfo.filter(employee => {
                    const matchesDepartment = filterDepartment ? employee.department === filterDepartment : true;
                    const matchesSearch = searchTerm ?
                        employee.name.toLowerCase().includes(searchTerm) ||
                        employee.title.toLowerCase().includes(searchTerm) ||
                        employee.department.toLowerCase().includes(searchTerm) : true;
                    return matchesDepartment && matchesSearch;
                });

                // Sort by name for consistent pagination
                filteredAndSearachedEmployees = filteredAndSearched.sort((a, b) => a.name.localeCompare(b.name));

                updateEmployeeTable(); // Re-render table with filtered data
            } catch (error) {
                console.error("Error fetching employees for table:", error.message);
                renderEmployeeTable([]); // Render empty table on error
            }
        }


        // --- UI Layout and Navigation Logic ---

        function updateSidebarProfile(employeeData) {
            if (employeeData) {
                sidebarProfileName.textContent = `${employeeData.firstName || ''} ${employeeData.lastName || ''}`;
                // You'd fetch the actual position title from the positions table
                sidebarProfilePosition.textContent = employeeData.position || 'Employee'; // Placeholder
                // sidebarProfileAvatar.src = employeeData.avatar_url || 'https://placehold.co/60x60/ADD8E6/000000?text=HR';
            } else {
                sidebarProfileName.textContent = 'Guest';
                sidebarProfilePosition.textContent = '';
                // sidebarProfileAvatar.src = 'https://placehold.co/60x60/ADD8E6/000000?text=HR';
            }
        }

        function showHRMSLayout() {
            landingPage.classList.add('hidden');
            hrmsMainLayout.classList.remove('hidden');
            // Ensure sidebar and main content positioning is correct on login
            if (window.innerWidth >= 768) {
                sidebar.classList.remove('-translate-x-full');
                mainContent.classList.add('md:ml-64');
                topBanner.classList.add('md:pl-64');
                isSidebarOpen = true;
            } else {
                sidebar.classList.add('-translate-x-full');
                mainContent.classList.remove('md:ml-64');
                topBanner.classList.remove('md:pl-64');
                isSidebarOpen = false;
            }
            showPage('dashboard'); // Default to dashboard after login
            // Fetch and update employee table data when HRMS layout is shown
            fetchEmployeesForTable();
        }

        function showLandingPage() {
            hrmsMainLayout.classList.add('hidden');
            landingPage.classList.remove('hidden');
            showAuthForm('login'); // Always revert to login form on landing page
            updateSidebarProfile(null); // Clear sidebar profile
        }

        function toggleSidebar() {
            if (isSidebarOpen) {
                sidebar.classList.add('-translate-x-full');
                mainContent.classList.remove('md:ml-64');
                topBanner.classList.remove('md:pl-64');
            } else {
                sidebar.classList.remove('-translate-x-full');
                mainContent.classList.add('md:ml-64');
                topBanner.classList.add('md:pl-64');
            }
            isSidebarOpen = !isSidebarOpen;
        }

        function showPage(pageId) {
            pageContents.forEach(page => {
                page.classList.add('hidden');
                page.classList.remove('active');
            });
            const targetPage = document.getElementById(pageId + '-page');
            if (targetPage) {
                targetPage.classList.remove('hidden');
                targetPage.classList.add('active');
                // Update page title in top banner
                pageTitleElement.textContent = pageId.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
            }
            // Update active class on sidebar links
            navLinks.forEach(link => {
                link.classList.remove('active-nav-link');
            });
            const activeLink = document.querySelector(`.nav-link[data-page="${pageId}"]`);
            if (activeLink) {
                activeLink.classList.add('active-nav-link');
            }
        }

        function renderEmployeeTable(employees) {
            const tableBody = document.getElementById('employee-table-body');
            tableBody.innerHTML = ''; // Clear existing rows

            if (employees.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="5" class="py-4 px-6 text-center text-gray-500">No employees found.</td></tr>`;
                return;
            }

            employees.forEach(employee => {
                const statusClass = employee.status === 'Active' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800';
                const row = `
                    <tr>
                        <td class="py-4 px-6 whitespace-nowrap text-sm font-medium text-gray-900">${employee.name}</td>
                        <td class="py-4 px-6 whitespace-nowrap text-sm text-gray-700">${employee.title}</td>
                        <td class="py-4 px-6 whitespace-nowrap text-sm text-gray-700">${employee.department}</td>
                        <td class="py-4 px-6 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}">
                                ${employee.status}
                            </span>
                        </td>
                        <td class="py-4 px-6 whitespace-nowrap text-sm font-medium">
                            <button class="text-blue-600 hover:text-blue-900 mr-3 transition duration-150 ease-in-out">View</button>
                            <button class="text-indigo-600 hover:text-indigo-900 mr-3 transition duration-150 ease-in-out">Edit</button>
                            <button class="text-red-600 hover:text-red-900 transition duration-150 ease-in-out">Delete</button>
                        </td>
                    </tr>
                `;
                tableBody.insertAdjacentHTML('beforeend', row);
            });
        }

        function renderPagination(totalPages, currentPage, paginateCallback) {
            const paginationContainer = document.getElementById('employee-pagination');
            paginationContainer.innerHTML = ''; // Clear existing buttons

            for (let i = 1; i <= totalPages; i++) {
                const button = document.createElement('button');
                button.textContent = i;
                button.classList.add('mx-1', 'px-4', 'py-2', 'rounded-md', 'transition', 'duration-300');
                if (currentPage === i) {
                    button.classList.add('bg-blue-600', 'text-white', 'shadow-md');
                } else {
                    button.classList.add('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
                }
                button.addEventListener('click', () => paginateCallback(i));
                paginationContainer.appendChild(button);
            }
        }

        let currentEmployeePage = 1;
        const employeesPerPage = 10;
        let filteredAndSearchedEmployees = []; // This will hold data fetched from Supabase

        function updateEmployeeTable() {
            const indexOfLastEmployee = currentEmployeePage * employeesPerPage;
            const indexOfFirstEmployee = indexOfLastEmployee - employeesPerPage;
            const employeesToRender = filteredAndSearchedEmployees.slice(indexOfFirstEmployee, indexOfLastEmployee);

            renderEmployeeTable(employeesToRender);

            const totalPages = Math.ceil(filteredAndSearchedEmployees.length / employeesPerPage);
            renderPagination(totalPages, currentEmployeePage, (page) => {
                currentEmployeePage = page;
                updateEmployeeTable();
            });
        }


        // --- Event Listeners ---
        document.addEventListener('DOMContentLoaded', async () => {
            // Check initial auth state
            try {
                const { data: { session }, error } = await supabase.auth.getSession();
                if (error) throw error;

                if (session) {
                    currentAuthenticatedUser = session.user;
                    console.log("User already logged in:", currentAuthenticatedUser);
                    await ensureEmployeeRecord(currentAuthenticatedUser); // Fetch/create employee record
                    showHRMSLayout();
                } else {
                    console.log("No active session, showing landing page.");
                    showLandingPage();
                }
            } catch (error) {
                console.error("Error checking initial session:", error.message);
                showLandingPage(); // Fallback to landing page on error
            }

            // Auth form switching
            showRegisterFormBtn.addEventListener('click', () => showAuthForm('register'));
            showLoginFormBtn.addEventListener('click', () => showAuthForm('login'));

            // Password visibility toggles
            toggleLoginPassword.addEventListener('click', () => togglePasswordVisibility(loginPasswordInput, toggleLoginPassword));
            toggleRegisterPassword.addEventListener('click', () => togglePasswordVisibility(registerPasswordInput, toggleRegisterPassword));
            toggleConfirmPassword.addEventListener('click', () => togglePasswordVisibility(confirmPasswordInput, toggleConfirmPassword));

            // Form submissions
            loginForm.addEventListener('submit', handleLogin);
            registerForm.addEventListener('submit', handleRegister);

            // Sidebar toggle
            sidebarToggleBtn.addEventListener('click', toggleSidebar);

            // Close sidebar on small screens when a nav item is clicked
            navLinks.forEach(link => {
                link.addEventListener('click', () => {
                    if (window.innerWidth < 768) {
                        toggleSidebar();
                    }
                });
            });

            // Adjust sidebar based on window resize
            window.addEventListener('resize', () => {
                if (window.innerWidth >= 768) {
                    sidebar.classList.remove('-translate-x-full');
                    mainContent.classList.add('md:ml-64');
                    topBanner.classList.add('md:pl-64');
                    isSidebarOpen = true;
                } else {
                    if (isSidebarOpen) {
                        // If it was open on large screen, let user explicitly close it on smaller
                    } else {
                        sidebar.classList.add('-translate-x-full');
                        mainContent.classList.remove('md:ml-64');
                        topBanner.classList.remove('md:pl-64');
                    }
                }
            });

            // Page navigation
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = link.dataset.page;
                    showPage(page);
                    // For employee management, update table when its page is active
                    if (page === 'employee-management') {
                        currentEmployeePage = 1; // Reset to first page
                        fetchEmployeesForTable(); // Re-fetch and update table
                    }
                });
            });

            // Notifications Dropdown Logic
            notificationsButton.addEventListener('click', (e) => {
                e.stopPropagation(); // Prevent click from bubbling to document
                notificationsDropdown.classList.toggle('hidden');
                if (!notificationsDropdown.classList.contains('hidden')) {
                    notificationsDropdown.classList.add('animate-fade-in-down');
                } else {
                     notificationsDropdown.classList.remove('animate-fade-in-down');
                }
            });

            // Close dropdown if clicked outside
            document.addEventListener('click', (e) => {
                if (!notificationsButton.contains(e.target) && !notificationsDropdown.contains(e.target)) {
                    notificationsDropdown.classList.add('hidden');
                }
            });

            // Logout button
            logoutButton.addEventListener('click', handleLogout);

            // Employee Management page filters/search
            document.getElementById('department-filter').addEventListener('change', () => {
                currentEmployeePage = 1;
                fetchEmployeesForTable(); // Re-fetch with new filter
            });
            document.getElementById('employee-search').addEventListener('input', () => {
                currentEmployeePage = 1;
                fetchEmployeesForTable(); // Re-fetch with new search term
            });
        });

        // Listen for auth state changes from Supabase (optional, but good for real-time UI updates)
        supabase.auth.onAuthStateChange(async (event, session) => {
            console.log(`Supabase auth event: ${event}`, session);
            if (event === 'SIGNED_IN' || event === 'TOKEN_REFRESHED') {
                currentAuthenticatedUser = session.user;
                console.log('User logged in or session refreshed:', currentAuthenticatedUser);
                await ensureEmployeeRecord(currentAuthenticatedUser);
                if (hrmsMainLayout.classList.contains('hidden')) {
                    showHRMSLayout();
                }
            } else if (event === 'SIGNED_OUT') {
                console.log('User logged out');
                currentAuthenticatedUser = null;
                if (!hrmsMainLayout.classList.contains('hidden')) {
                    showLandingPage();
                }
            }
        });

    </script>
</body>
</html>
